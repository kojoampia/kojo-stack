{"ast":null,"code":"import { BehaviorSubject, Observable, tap } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class AuthService {\n  constructor(http) {\n    this.http = http;\n    this.API_URL = '/api/v1/auth';\n    this.currentUserSubject = new BehaviorSubject(this.getUserFromStorage());\n    this.currentUser$ = this.currentUserSubject.asObservable();\n  }\n  /**\n   * Login with username and password\n   */\n  login(username, password) {\n    const loginRequest = {\n      username,\n      password\n    };\n    return this.http.post(`${this.API_URL}/login`, loginRequest).pipe(tap(response => {\n      // Store token\n      if (response.token) {\n        localStorage.setItem('auth_token', response.token);\n      }\n      // Store user\n      if (response.user) {\n        localStorage.setItem('current_user', JSON.stringify(response.user));\n        this.currentUserSubject.next(response.user);\n      }\n    }));\n  }\n  /**\n   * Validate token with the server\n   */\n  validateToken() {\n    const token = this.getToken();\n    if (!token) {\n      return new Observable(observer => {\n        observer.next({\n          valid: false\n        });\n        observer.complete();\n      });\n    }\n    return this.http.post(`${this.API_URL}/validate`, {\n      token\n    });\n  }\n  /**\n   * Logout user\n   */\n  logout() {\n    localStorage.removeItem('auth_token');\n    localStorage.removeItem('current_user');\n    this.currentUserSubject.next(null);\n  }\n  /**\n   * Check if user is logged in\n   */\n  isLoggedIn() {\n    return !!this.getToken();\n  }\n  /**\n   * Get current token\n   */\n  getToken() {\n    return localStorage.getItem('auth_token');\n  }\n  /**\n   * Get current user\n   */\n  getCurrentUser() {\n    return this.currentUserSubject.value;\n  }\n  /**\n   * Get user from storage\n   */\n  getUserFromStorage() {\n    const user = localStorage.getItem('current_user');\n    return user ? JSON.parse(user) : null;\n  }\n  /**\n   * Check if current user has specific role\n   */\n  hasRole(role) {\n    const user = this.getCurrentUser();\n    if (!user || !user.authorities) return false;\n    return user.authorities.some(auth => auth.name === role || auth.name === `ROLE_${role}`);\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","Observable","tap","AuthService","constructor","http","API_URL","currentUserSubject","getUserFromStorage","currentUser$","asObservable","login","username","password","loginRequest","post","pipe","response","token","localStorage","setItem","user","JSON","stringify","next","validateToken","getToken","observer","valid","complete","logout","removeItem","isLoggedIn","getItem","getCurrentUser","value","parse","hasRole","role","authorities","some","auth","name","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["/home/kojo/work/JojoAddisonDev/kojo-stack/src/app/core/services/auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { BehaviorSubject, Observable, tap } from 'rxjs';\n\nexport interface UserLoginDTO {\n  id?: string;\n  username: string;\n  email?: string;\n  password: string;\n  authorities?: Authority[];\n}\n\nexport interface Authority {\n  id?: string;\n  name: string;\n}\n\nexport interface AuthResponse {\n  token: string;\n  user: UserLoginDTO;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  private readonly API_URL = '/api/v1/auth';\n  private currentUserSubject = new BehaviorSubject<UserLoginDTO | null>(this.getUserFromStorage());\n  public currentUser$ = this.currentUserSubject.asObservable();\n\n  constructor(private http: HttpClient) {}\n\n  /**\n   * Login with username and password\n   */\n  login(username: string, password: string): Observable<AuthResponse> {\n    const loginRequest: UserLoginDTO = { username, password };\n    \n    return this.http.post<AuthResponse>(`${this.API_URL}/login`, loginRequest).pipe(\n      tap((response) => {\n        // Store token\n        if (response.token) {\n          localStorage.setItem('auth_token', response.token);\n        }\n        // Store user\n        if (response.user) {\n          localStorage.setItem('current_user', JSON.stringify(response.user));\n          this.currentUserSubject.next(response.user);\n        }\n      })\n    );\n  }\n\n  /**\n   * Validate token with the server\n   */\n  validateToken(): Observable<{ valid: boolean }> {\n    const token = this.getToken();\n    if (!token) {\n      return new Observable((observer) => {\n        observer.next({ valid: false });\n        observer.complete();\n      });\n    }\n\n    return this.http.post<{ valid: boolean }>(`${this.API_URL}/validate`, { token });\n  }\n\n  /**\n   * Logout user\n   */\n  logout(): void {\n    localStorage.removeItem('auth_token');\n    localStorage.removeItem('current_user');\n    this.currentUserSubject.next(null);\n  }\n\n  /**\n   * Check if user is logged in\n   */\n  isLoggedIn(): boolean {\n    return !!this.getToken();\n  }\n\n  /**\n   * Get current token\n   */\n  getToken(): string | null {\n    return localStorage.getItem('auth_token');\n  }\n\n  /**\n   * Get current user\n   */\n  getCurrentUser(): UserLoginDTO | null {\n    return this.currentUserSubject.value;\n  }\n\n  /**\n   * Get user from storage\n   */\n  private getUserFromStorage(): UserLoginDTO | null {\n    const user = localStorage.getItem('current_user');\n    return user ? JSON.parse(user) : null;\n  }\n\n  /**\n   * Check if current user has specific role\n   */\n  hasRole(role: string): boolean {\n    const user = this.getCurrentUser();\n    if (!user || !user.authorities) return false;\n    \n    return user.authorities.some((auth) => auth.name === role || auth.name === `ROLE_${role}`);\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}