{"ast":null,"code":"/**\n * Generate a random 32-character hex string for trace/span IDs\n */\nfunction generateId() {\n  let id = '';\n  for (let i = 0; i < 16; i++) {\n    id += Math.floor(Math.random() * 16).toString(16);\n  }\n  return id;\n}\n/**\n * Generate W3C Trace Context compliant traceparent header\n * Format: 00-{trace-id}-{span-id}-{trace-flags}\n */\nfunction generateTraceContext() {\n  const traceId = generateId();\n  const spanId = generateId().substring(0, 16);\n  const traceFlags = '01'; // Sampled=true\n  const traceparent = `00-${traceId}-${spanId}-${traceFlags}`;\n  return {\n    traceparent,\n    traceId\n  };\n}\n/**\n * HTTP Interceptor that adds W3C Trace Context headers to all HTTP requests.\n */\nexport const traceIdInterceptor = (req, next) => {\n  const {\n    traceparent,\n    traceId\n  } = generateTraceContext();\n  const clonedRequest = req.clone({\n    setHeaders: {\n      'traceparent': traceparent,\n      'X-Trace-Id': traceId,\n      'X-B3-TraceId': traceId,\n      'X-B3-SpanId': traceId.substring(0, 16),\n      'X-B3-Sampled': '1'\n    }\n  });\n  if (req.method !== 'GET') {\n    console.debug(`[TRACE-${traceId}] ${req.method} ${req.url}`);\n  }\n  return next(clonedRequest);\n};","map":{"version":3,"names":["generateId","id","i","Math","floor","random","toString","generateTraceContext","traceId","spanId","substring","traceFlags","traceparent","traceIdInterceptor","req","next","clonedRequest","clone","setHeaders","method","console","debug","url"],"sources":["/home/kojo/work/JojoAddisonDev/kojo-stack/src/app/core/trace-id/trace-id.interceptor.ts"],"sourcesContent":["import {\n  HttpEvent,\n  HttpHandlerFn,\n  HttpInterceptorFn,\n  HttpRequest\n} from '@angular/common/http';\nimport { Observable } from 'rxjs';\n\n/**\n * Generate a random 32-character hex string for trace/span IDs\n */\nfunction generateId(): string {\n  let id = '';\n  for (let i = 0; i < 16; i++) {\n    id += Math.floor(Math.random() * 16).toString(16);\n  }\n  return id;\n}\n\n/**\n * Generate W3C Trace Context compliant traceparent header\n * Format: 00-{trace-id}-{span-id}-{trace-flags}\n */\nfunction generateTraceContext(): { traceparent: string; traceId: string } {\n  const traceId = generateId();\n  const spanId = generateId().substring(0, 16);\n  const traceFlags = '01'; // Sampled=true\n  const traceparent = `00-${traceId}-${spanId}-${traceFlags}`;\n  \n  return { traceparent, traceId };\n}\n\n/**\n * HTTP Interceptor that adds W3C Trace Context headers to all HTTP requests.\n */\nexport const traceIdInterceptor: HttpInterceptorFn = (\n  req: HttpRequest<unknown>,\n  next: HttpHandlerFn\n): Observable<HttpEvent<unknown>> => {\n  const { traceparent, traceId } = generateTraceContext();\n\n  const clonedRequest = req.clone({\n    setHeaders: {\n      'traceparent': traceparent,\n      'X-Trace-Id': traceId,\n      'X-B3-TraceId': traceId,\n      'X-B3-SpanId': traceId.substring(0, 16),\n      'X-B3-Sampled': '1'\n    }\n  });\n\n  if (req.method !== 'GET') {\n    console.debug(`[TRACE-${traceId}] ${req.method} ${req.url}`);\n  }\n\n  return next(clonedRequest);\n};\n\n"],"mappings":"AAQA;;;AAGA,SAASA,UAAUA,CAAA;EACjB,IAAIC,EAAE,GAAG,EAAE;EACX,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,EAAE,EAAEA,CAAC,EAAE,EAAE;IAC3BD,EAAE,IAAIE,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,EAAE,GAAG,EAAE,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC;;EAEnD,OAAOL,EAAE;AACX;AAEA;;;;AAIA,SAASM,oBAAoBA,CAAA;EAC3B,MAAMC,OAAO,GAAGR,UAAU,EAAE;EAC5B,MAAMS,MAAM,GAAGT,UAAU,EAAE,CAACU,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC;EAC5C,MAAMC,UAAU,GAAG,IAAI,CAAC,CAAC;EACzB,MAAMC,WAAW,GAAG,MAAMJ,OAAO,IAAIC,MAAM,IAAIE,UAAU,EAAE;EAE3D,OAAO;IAAEC,WAAW;IAAEJ;EAAO,CAAE;AACjC;AAEA;;;AAGA,OAAO,MAAMK,kBAAkB,GAAsBA,CACnDC,GAAyB,EACzBC,IAAmB,KACe;EAClC,MAAM;IAAEH,WAAW;IAAEJ;EAAO,CAAE,GAAGD,oBAAoB,EAAE;EAEvD,MAAMS,aAAa,GAAGF,GAAG,CAACG,KAAK,CAAC;IAC9BC,UAAU,EAAE;MACV,aAAa,EAAEN,WAAW;MAC1B,YAAY,EAAEJ,OAAO;MACrB,cAAc,EAAEA,OAAO;MACvB,aAAa,EAAEA,OAAO,CAACE,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC;MACvC,cAAc,EAAE;;GAEnB,CAAC;EAEF,IAAII,GAAG,CAACK,MAAM,KAAK,KAAK,EAAE;IACxBC,OAAO,CAACC,KAAK,CAAC,UAAUb,OAAO,KAAKM,GAAG,CAACK,MAAM,IAAIL,GAAG,CAACQ,GAAG,EAAE,CAAC;;EAG9D,OAAOP,IAAI,CAACC,aAAa,CAAC;AAC5B,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}