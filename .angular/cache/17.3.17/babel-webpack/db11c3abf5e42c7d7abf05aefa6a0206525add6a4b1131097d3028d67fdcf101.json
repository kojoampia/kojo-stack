{"ast":null,"code":"import * as i0 from \"@angular/core\";\n/**\n * HTTP Interceptor that adds W3C Trace Context headers to all HTTP requests\n * for distributed tracing with OpenTelemetry backend integration\n *\n * Follows W3C Trace Context standard:\n * - traceparent: 00-{trace-id}-{span-id}-{trace-flags}\n * - tracestate: optional vendor-specific trace state\n */\nexport class TraceIdInterceptor {\n  /**\n   * Generate a random 32-character hex string for trace/span IDs\n   */\n  generateId() {\n    let id = '';\n    for (let i = 0; i < 16; i++) {\n      id += Math.floor(Math.random() * 16).toString(16);\n    }\n    return id;\n  }\n  /**\n   * Generate W3C Trace Context compliant traceparent header\n   * Format: 00-{trace-id}-{span-id}-{trace-flags}\n   * - version: 00 (current version)\n   * - trace-id: 32 hex chars\n   * - span-id: 16 hex chars\n   * - trace-flags: 01 (sampled) or 00 (not sampled)\n   */\n  generateTraceContext() {\n    const traceId = this.generateId();\n    const spanId = this.generateId().substring(0, 16); // 16 hex chars for span\n    const traceFlags = '01'; // Sampled=true for all requests\n    const traceparent = `00-${traceId}-${spanId}-${traceFlags}`;\n    return {\n      traceparent,\n      traceId\n    };\n  }\n  intercept(request, next) {\n    // Generate W3C compliant trace context\n    const {\n      traceparent,\n      traceId\n    } = this.generateTraceContext();\n    // Clone the request and add W3C Trace Context headers\n    const clonedRequest = request.clone({\n      setHeaders: {\n        // W3C Trace Context standard headers (primary)\n        'traceparent': traceparent,\n        // Optional: Custom header for additional tracking\n        'X-Trace-Id': traceId,\n        // B3 headers for backward compatibility with B3 propagators\n        'X-B3-TraceId': traceId,\n        'X-B3-SpanId': traceId.substring(0, 16),\n        'X-B3-Sampled': '1'\n      }\n    });\n    // Log the trace ID for debugging (optional)\n    if (request.method !== 'GET') {\n      console.debug(`[TRACE-${traceId}] ${request.method} ${request.url}`);\n    }\n    // Forward the modified request\n    return next.handle(clonedRequest);\n  }\n  static {\n    this.ɵfac = function TraceIdInterceptor_Factory(t) {\n      return new (t || TraceIdInterceptor)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: TraceIdInterceptor,\n      factory: TraceIdInterceptor.ɵfac\n    });\n  }\n}","map":{"version":3,"names":["TraceIdInterceptor","generateId","id","i","Math","floor","random","toString","generateTraceContext","traceId","spanId","substring","traceFlags","traceparent","intercept","request","next","clonedRequest","clone","setHeaders","method","console","debug","url","handle","factory","ɵfac"],"sources":["/home/kojo/work/JojoAddisonDev/kojo-stack/src/app/core/trace-id/trace-id.interceptor.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport {\n  HttpRequest,\n  HttpHandler,\n  HttpEvent,\n  HttpInterceptor\n} from '@angular/common/http';\nimport { Observable } from 'rxjs';\n\n/**\n * HTTP Interceptor that adds W3C Trace Context headers to all HTTP requests\n * for distributed tracing with OpenTelemetry backend integration\n * \n * Follows W3C Trace Context standard:\n * - traceparent: 00-{trace-id}-{span-id}-{trace-flags}\n * - tracestate: optional vendor-specific trace state\n */\n@Injectable()\nexport class TraceIdInterceptor implements HttpInterceptor {\n  /**\n   * Generate a random 32-character hex string for trace/span IDs\n   */\n  private generateId(): string {\n    let id = '';\n    for (let i = 0; i < 16; i++) {\n      id += Math.floor(Math.random() * 16).toString(16);\n    }\n    return id;\n  }\n\n  /**\n   * Generate W3C Trace Context compliant traceparent header\n   * Format: 00-{trace-id}-{span-id}-{trace-flags}\n   * - version: 00 (current version)\n   * - trace-id: 32 hex chars\n   * - span-id: 16 hex chars\n   * - trace-flags: 01 (sampled) or 00 (not sampled)\n   */\n  private generateTraceContext(): { traceparent: string; traceId: string } {\n    const traceId = this.generateId();\n    const spanId = this.generateId().substring(0, 16); // 16 hex chars for span\n    const traceFlags = '01'; // Sampled=true for all requests\n    const traceparent = `00-${traceId}-${spanId}-${traceFlags}`;\n    \n    return { traceparent, traceId };\n  }\n\n  intercept(request: HttpRequest<unknown>, next: HttpHandler): Observable<HttpEvent<unknown>> {\n    // Generate W3C compliant trace context\n    const { traceparent, traceId } = this.generateTraceContext();\n\n    // Clone the request and add W3C Trace Context headers\n    const clonedRequest = request.clone({\n      setHeaders: {\n        // W3C Trace Context standard headers (primary)\n        'traceparent': traceparent,\n        \n        // Optional: Custom header for additional tracking\n        'X-Trace-Id': traceId,\n        \n        // B3 headers for backward compatibility with B3 propagators\n        'X-B3-TraceId': traceId,\n        'X-B3-SpanId': traceId.substring(0, 16),\n        'X-B3-Sampled': '1'\n      }\n    });\n\n    // Log the trace ID for debugging (optional)\n    if (request.method !== 'GET') {\n      console.debug(`[TRACE-${traceId}] ${request.method} ${request.url}`);\n    }\n\n    // Forward the modified request\n    return next.handle(clonedRequest);\n  }\n}\n\n"],"mappings":";AASA;;;;;;;;AASA,OAAM,MAAOA,kBAAkB;EAC7B;;;EAGQC,UAAUA,CAAA;IAChB,IAAIC,EAAE,GAAG,EAAE;IACX,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,EAAE,EAAEA,CAAC,EAAE,EAAE;MAC3BD,EAAE,IAAIE,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,EAAE,GAAG,EAAE,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC;;IAEnD,OAAOL,EAAE;EACX;EAEA;;;;;;;;EAQQM,oBAAoBA,CAAA;IAC1B,MAAMC,OAAO,GAAG,IAAI,CAACR,UAAU,EAAE;IACjC,MAAMS,MAAM,GAAG,IAAI,CAACT,UAAU,EAAE,CAACU,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;IACnD,MAAMC,UAAU,GAAG,IAAI,CAAC,CAAC;IACzB,MAAMC,WAAW,GAAG,MAAMJ,OAAO,IAAIC,MAAM,IAAIE,UAAU,EAAE;IAE3D,OAAO;MAAEC,WAAW;MAAEJ;IAAO,CAAE;EACjC;EAEAK,SAASA,CAACC,OAA6B,EAAEC,IAAiB;IACxD;IACA,MAAM;MAAEH,WAAW;MAAEJ;IAAO,CAAE,GAAG,IAAI,CAACD,oBAAoB,EAAE;IAE5D;IACA,MAAMS,aAAa,GAAGF,OAAO,CAACG,KAAK,CAAC;MAClCC,UAAU,EAAE;QACV;QACA,aAAa,EAAEN,WAAW;QAE1B;QACA,YAAY,EAAEJ,OAAO;QAErB;QACA,cAAc,EAAEA,OAAO;QACvB,aAAa,EAAEA,OAAO,CAACE,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC;QACvC,cAAc,EAAE;;KAEnB,CAAC;IAEF;IACA,IAAII,OAAO,CAACK,MAAM,KAAK,KAAK,EAAE;MAC5BC,OAAO,CAACC,KAAK,CAAC,UAAUb,OAAO,KAAKM,OAAO,CAACK,MAAM,IAAIL,OAAO,CAACQ,GAAG,EAAE,CAAC;;IAGtE;IACA,OAAOP,IAAI,CAACQ,MAAM,CAACP,aAAa,CAAC;EACnC;;;uBAxDWjB,kBAAkB;IAAA;EAAA;;;aAAlBA,kBAAkB;MAAAyB,OAAA,EAAlBzB,kBAAkB,CAAA0B;IAAA;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}